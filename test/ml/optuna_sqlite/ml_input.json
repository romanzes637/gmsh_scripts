{
  "metadata": {
    "comments": "J - Jacobian determinant, IGE - Inverse Gradient Error, ICN - Condition Number",
    "ml": {}
  },
  "data": {
    "class": "action.optimize.Optuna",
    "tag": "test_optuna_sqlite",
    "jobs": 1,
    "timeout": null,
    "n_trials": 3,
    "work_path": "opt",
    "storage": "sqlite:///example.db",
    "study_name": "test_optuna_sqlite",
    "do_create_study": true,
    "do_read_study": true,
    "do_delete_study": false,
    "do_optimize": true,
    "do_write_results": true,
    "results_color_key": "objective_metrics",
    "copies": ["_run_input.json"],
    "links": null,
    "sampler": "RandomSampler",
    "sampler_kwargs": null,
    "pruner": "NopPruner",
    "pruner_kwargs":  null,
    "do_update_sub_actions": false,
    "update_sub_actions_trial": null,
    "do_sub_call": false,
    "sub_actions": [
      {"key": "size_points", "class": "action.Feature",
        "pre_call": {"class": "action.set.Continuous", "low": 0.3, "high": 0.8},
        "post_call": {"class": "action.get.Json", "path": "_run_input.json",
          "mapping": {"data": {"layer": [["1;{};5", "2;{};5"], ["1;{};5", "2;{};5"]]}}}
      },
      {"key": "size_curvature", "class": "action.Feature",
        "pre_call": {"class": "action.set.Discrete", "low": 10, "high": 40, "num": 31},
        "post_call": {"class": "action.get.Json", "path": "_run_input.json",
          "mapping": {"metadata": {"run": {"options": {"Mesh.MeshSizeFromCurvature": "{}"}}}}}
      },
      {"key": "size_min", "class": "action.Feature",
        "pre_call": {"class": "action.set.Continuous", "low": 0, "high": 1},
        "post_call": {"class": "action.get.Json", "path": "_run_input.json",
          "mapping": {"metadata": {"run": {"options": {"Mesh.MeshSizeMin": "{}"}}}}}
      },
      {"key": "size_max", "class": "action.Feature",
        "pre_call": {"class": "action.set.Continuous", "low": 1, "high": 5},
        "post_call": {"class": "action.get.Json", "path": "_run_input.json",
          "mapping": {"metadata": {"run": {"options": {"Mesh.MeshSizeMax": "{}"}}}}}
      },
      {"key": "size_factor", "class": "action.Feature",
        "pre_call": {"class": "action.set.Continuous", "low": 0.5, "high": 1},
        "post_call": {"class": "action.get.Json", "path": "_run_input.json",
          "mapping": {"metadata": {"run": {"options": {"Mesh.MeshSizeFactor": "{}"}}}}}
      },
      {"key": "size_boundary", "class": "action.Feature",
        "pre_call": {"class": "action.set.Discrete", "low": 1, "high": 2, "num": 2},
        "post_call": {"class": "action.get.Json", "path": "_run_input.json",
          "mapping": {"metadata": {"run": {"options": {"Mesh.MeshSizeExtendFromBoundary": "{}"}}}}}
      },
      {"class": "action.run.GmshScripts",
        "run_path": "../../../run.py",
        "output_formats": ["msh2", "vtk"],
        "input_path": "_run_input.json",
        "output_path": "_run_output",
        "log_path": "_run_input.log",
        "log_level": "DEBUG"
      },
      {"key": "elements", "class": "action.Feature",
        "pre_call": {"class": "action.set.RegexFile", "path": "_run_input.log",
          "value_type": "int", "regex": "Total:.*((?<=and)[\\s0-9]*(?=elements))"}
      },
      {"key": "constraint_J", "class": "action.Feature",
        "pre_call": {"class": "action.set.Equation", "equation": "{0} is not None and {0} > 0",
          "sub_actions": [
            {"class": "action.Feature", "key": "minJ_min",
            "pre_call": {"class": "action.set.RegexFile", "path": "_run_input.log",
              "value_type": "float", "regex": "Info: minJ .*((?<==)[\\s0-9.e-]*(?=,))"}}
          ]}
      },
      {"key": "objective_elements", "class": "action.Feature",
        "pre_call": {"class": "action.set.Equation", "equation": "{0}",
          "sub_actions": [
          {"class": "action.Feature",
            "key": "elements",
            "pre_call": {"class": "action.set.RegexFile", "path": "_run_input.log",
              "value_type": "int", "regex": "Total:.*((?<=and)[\\s0-9]*(?=elements))"}}
          ]}
      },
      {"key": "objective_metrics", "class": "action.Feature",
        "pre_call": {"class": "action.set.Equation", "equation": "min([{0}, {1}, {2}])",
          "sub_actions": [
            {"key": "minJ_by_maxJ_min", "class": "action.Feature",
            "pre_call": {"class": "action.set.RegexFile", "path": "_run_input.log",
              "value_type": "float", "regex": "Info: minJ/maxJ .*((?<==)[\\s0-9.e-]*(?=,))"}},
            {"key": "IGE_min", "class": "action.Feature",
            "pre_call": {"class": "action.set.RegexFile", "path": "_run_input.log",
              "value_type": "float", "regex": "Info: IGE .*((?<==)[\\s0-9.e-]*(?=,))"}},
            {"key": "ICN_min", "class": "action.Feature",
            "pre_call": {"class": "action.set.RegexFile", "path": "_run_input.log",
              "value_type": "float", "regex": "Info: ICN .*((?<==)[\\s0-9.e-]*(?=,))"}}
          ]}
      }
    ],
    "objectives": {
      "objective_elements": "maximize",
      "objective_metrics": "minimize"
    },
    "constraints": ["constraint_J"]
  }
}
